<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="index.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Encode+Sans+Semi+Expanded:wght@400;700&family=Montserrat:wght@200;700&display=swap" rel="stylesheet">
    <title>Stars</title>
    <script src="extra/highlight.pack.js" type="text/javascript"></script>
	  <script src="stuquery.js"></script>
    <script src="starsData.mjs" type="text/javascript"></script>
	  <script src="virtualsky.js" type="text/javascript"></script>
  </head>
  <body>
    <div id="root"></div>
    <div class="content gradient__bg">
      <div class="heading">950 stars remaining of visibility magnitute 11</div>
      <div class="heading" id="nameStar">Name Your Star</div>
      <form id="formContainer">
        <div class="name">
          <label for="name">Star Name: </label>
          <div>
            <input type="text" name="name" id="name">
          </div>
        </div>

        <div class="message">
          <label for="message">Personalized Message:</label>
          <div>
            <textarea id="message" name="message"
              rows="10" cols="1" placeholder="Enter your message here"></textarea>
          </div>
        </div>

        <div class="email">
          <label for="email">Your Email: </label>
          <div>
            <input type="email" name="email" id="email">
          </div>
        </div>
        <div class="submit">
          <input type="submit" id="submit" value="Send">
        </div>
        </div>

      </form>
      <div id="cards"></div>
      <div class="search">
        <input class="searchInput"></input>
        <button id="search">Search</button>
      </div>
      <div id="starmap-splash" class="planetarium"></div>

      <script>
      S(document).ready(async function() {
        var vs = S.virtualsky({
          id:'starmap-splash',
          projection:'gnomic',
          ra: 83.8220833,
          dec: -5.3911111,
          gridlines_az:true,
          constellations:true,
          gradient:true,
          cardinalpoints:true,
          fontsize: '22px',
          // fontfamily: 'Manrope',
          az:90,
          showstarlabels:true,
          scalestars:2.5,
          allowTransparency:true,
          constellationlabels:true});

          S('button#search').on('click',function(){
                // console.log(S('input.searchInput')[0].value)

                let value = S('input.searchInput')[0].value

                value = Number(value);
                // console.log('value: ', value);
                vs.panTo(value);
          });

          let type;

          S('div.card').on('click', function(event) {
            event.preventDefault();
            event.stopPropagation();

            if (event.currentTarget.outerText === 'Visible') {
              type = 'visible'
            } else {
              type = 'bright'
            }
          })

          S('input#submit').on('click', async function(event) {
            event.preventDefault();
            event.stopPropagation();

            // console.log('selected type: ', type);

            let star = vs.pickStar(type);

            console.log('picked star: ', star);

            if(star) {
              vs.addPointer({
                ra:star.ra,
                dec:star.dec,
                label:S('input#name')[0].value,
                // img:'https://www.nicepng.com/maxp/u2w7o0a9y3w7e6q8/',
                // url: 'https://www.reddit.com/',
                html: 'html5',
                colour:'#fff',
                // height: '100px',
                uniqueId: star.uniqueId,
                // style: "border-radius:50px;"
            })
            }



            console.log('random star: ', star);
            star.label = S('input#name')[0].value;

            addStar({
              starName: S('input#name')[0].value,
              message: S('textarea#message')[0].value,
              // recipient: S('input#email')[0].value,
              sender: S('input#email')[0].value,
              uniqueId: star.uniqueId,
              ra: star.ra,
              dec: star.dec,
              mag: star.mag,
            });

            // let getStars = getStars();
            // console.log('getStars: ', getStars())

            // clear the form
            S('input#name')[0].value = "";
            S('input#email')[0].value = "";
            // S('input#email')[1].value = "";
          })


          getStars();
          let addStarsFromDb = await getStars();
          console.log('get stars: ', addStarsFromDb);
        // console.log('vs: ', vs);
      });
      </script>
    </div>

    <!-- <div id="root2"></div> -->

    <script language="javascript" type="text/javascript" src="formatexamples.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script type="text/javascript" src="main.js"></script>
  </body>
</html>
